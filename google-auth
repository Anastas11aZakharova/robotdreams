getAccessToken.ts
----
import { OAuth2Client } from "google-auth-library";
import fs from "fs";
import path from "path";

const CREDENTIALS_PATH = path.join(__dirname, "credentials.json");
const TOKEN_PATH = path.join(__dirname, "token.json");

// Load client credentials
const credentials = JSON.parse(fs.readFileSync(CREDENTIALS_PATH, "utf-8"));
const { client_id, client_secret, redirect_uris } = credentials.web; // or credentials.installed

const oAuth2Client = new OAuth2Client(client_id, client_secret, redirect_uris[0]);

async function getAccessToken() {
    const authUrl = oAuth2Client.generateAuthUrl({
        access_type: "offline",
        scope: ["https://www.googleapis.com/auth/userinfo.profile", "https://www.googleapis.com/auth/userinfo.email"],
        prompt: "consent",
    });

    console.log("Authorize this app by visiting this URL:", authUrl);
}

getAccessToken();


----------
loginWithOAuth.ts


import { OAuth2Client } from "google-auth-library";
import fs from "fs";
import path from "path";
import readline from "readline";

const CREDENTIALS_PATH = path.join(__dirname, "credentials.json");
const TOKEN_PATH = path.join(__dirname, "token.json");

const credentials = JSON.parse(fs.readFileSync(CREDENTIALS_PATH, "utf-8"));
const { client_id, client_secret, redirect_uris } = credentials.web; // or credentials.installed

const oAuth2Client = new OAuth2Client(client_id, client_secret, redirect_uris[0]);

async function loginWithOAuth() {
    const authUrl = oAuth2Client.generateAuthUrl({
        access_type: "offline",
        scope: ["https://www.googleapis.com/auth/userinfo.profile", "https://www.googleapis.com/auth/userinfo.email"],
        prompt: "consent",
    });

    console.log("Authorize this app by visiting this URL:", authUrl);

    const rl = readline.createInterface({
        input: process.stdin,
        output: process.stdout,
    });

    rl.question("Enter the code from that page here: ", async (code) => {
        rl.close();
        try {
            const { tokens } = await oAuth2Client.getToken(code);
            fs.writeFileSync(TOKEN_PATH, JSON.stringify(tokens, null, 2));
            console.log("Token stored to", TOKEN_PATH);
        } catch (error) {
            console.error("Error retrieving access token:", error);
        }
    });
}

loginWithOAuth();


----
refreshToken.ts

import { OAuth2Client } from "google-auth-library";
import fs from "fs";
import path from "path";

const CREDENTIALS_PATH = path.join(__dirname, "credentials.json");
const TOKEN_PATH = path.join(__dirname, "token.json");

const credentials = JSON.parse(fs.readFileSync(CREDENTIALS_PATH, "utf-8"));
const { client_id, client_secret, redirect_uris } = credentials.web; // or credentials.installed

const oAuth2Client = new OAuth2Client(client_id, client_secret, redirect_uris[0]);

async function refreshToken() {
    if (!fs.existsSync(TOKEN_PATH)) {
        console.error("No token found. Run loginWithOAuth.ts first.");
        return;
    }

    const tokenData = JSON.parse(fs.readFileSync(TOKEN_PATH, "utf-8"));
    oAuth2Client.setCredentials(tokenData);

    try {
        const newTokens = await oAuth2Client.refreshAccessToken();
        fs.writeFileSync(TOKEN_PATH, JSON.stringify(newTokens.credentials, null, 2));
        console.log("Token refreshed and saved.");
    } catch (error) {
        console.error("Error refreshing access token:", error);
    }
}

refreshToken();
